# coding: utf-8
import numpy as np
import tushare as ts
import pandas as pd
import os
import glob
import csv
import stock_class as sc
import numpy as np
import time
from datetime import datetime as dt
import datetime as d


pro = sc.get_tocken()
target_dir = 'D:/Program Files/tdx/vipdoc/sz/sz_tushare/sz_index'
# 清除文件
fileNames_illiq = glob.glob(target_dir + r'\*')
for fileName in fileNames_illiq:
    try:
        os.remove(fileName)
    except:
        break

stock_list = sc.get_sz_stock()
stock_num = stock_list.shape[0]

for i in range(0, stock_num):

    stock_code = stock_list.iloc[i]['ts_code']
    for _ in range(3):
        try:
            df = pro.daily_basic(ts_code=stock_code, start_date='20180101', end_date='20190907', fields='ts_code,trade_date,turnover_rate,volume_ratio,pe_ttm,pb,ps_ttm,total_mv,circ_mv')
            df = df.sort_values('trade_date', ascending=True)
            if df is None:
                continue
            else:
                pd.DataFrame.to_csv(df, target_dir + os.sep + stock_code + '.csv', encoding='gbk')
        except:
            time.sleep(2)












