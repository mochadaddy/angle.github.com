# coding: utf-8
'''
按照日线计算emv指标和maemv指标

'''
import tushare as ts
import pandas as pd
import os
import glob
import csv
import stock_class as sc
import numpy as np
import time
from datetime import datetime as dt
import datetime as d



'''
df = sc.get_stock_cap('000028.SZ', '20190813')
#df = df.sort_values(by='ts_code', ascending=True)
#df = df.reset_index(drop=True)
#row_num = df.shape[0]
print df
illiq_neutrilize = np.log10(df.iloc[0]['circ_mv'])
print illiq_neutrilize

target_dir_cap = 'D:/Program Files/tdx/vipdoc/sz/sz_tushare/sz_capital'
pro = sc.get_tocken()
df_cap = pro.query('daily_basic',  trade_date='20190809', fields='ts_code,trade_date,turnover_rate,circ_mv')
pd.DataFrame.to_csv(df_cap, target_dir_cap + os.sep + '20190809' + '.csv', encoding='gbk')
'''

df_new = pd.DataFrame()

target_dir = 'D:/Program Files/tdx/vipdoc/sz/sz_tushare/sz_detail'
pro = sc.get_tocken()
t = 0
start_date = '2018-12-28'
end_date = '2019-02-22'
#end_date = dt.strptime(end_date, '%Y-%m-%d')
while start_date <= end_date:
    start_date = dt.strptime(start_date, '%Y-%m-%d')
    start_date = start_date + d.timedelta(days=t)

    start_date = start_date.strftime('%Y-%m-%d')
    df_new = ts.get_tick_data('002587', date=start_date, src='tt')
    if df_new is None:
        continue
    else:
    #print df_new
        t = t + 1
        pd.DataFrame.to_csv(df_new, target_dir + os.sep + start_date + '-002587.csv', encoding='gbk')
    #start_date = start_date.strftime('%Y%m%d')

'''
row_num = df.shape[0]
for i in range(0,row_num):
    if df.iloc[i]['volume']>=100 and df.iloc[i]['volume']<=1000:
        df_new = df_new.append(df[i: i+1])
'''








